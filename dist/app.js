(()=>{var e={738:(e,t,s)=>{const r=s(147),n=s(17),o=s(37);function i(e){console.log(`[dotenv][DEBUG] ${e}`)}const a=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,d=/\\n/g,l=/\r\n|\n|\r/;function u(e,t){const s=Boolean(t&&t.debug),r={};return e.toString().split(l).forEach((function(e,t){const n=e.match(a);if(null!=n){const e=n[1];let t=n[2]||"";const s=t.length-1,o='"'===t[0]&&'"'===t[s];"'"===t[0]&&"'"===t[s]||o?(t=t.substring(1,s),o&&(t=t.replace(d,"\n"))):t=t.trim(),r[e]=t}else s&&i(`did not match key and value when parsing line ${t+1}: ${e}`)})),r}e.exports.config=function(e){let t=n.resolve(process.cwd(),".env"),s="utf8",a=!1;var d;e&&(null!=e.path&&(t="~"===(d=e.path)[0]?n.join(o.homedir(),d.slice(1)):d),null!=e.encoding&&(s=e.encoding),null!=e.debug&&(a=!0));try{const e=u(r.readFileSync(t,{encoding:s}),{debug:a});return Object.keys(e).forEach((function(t){Object.prototype.hasOwnProperty.call(process.env,t)?a&&i(`"${t}" is already defined in \`process.env\` and will not be overwritten`):process.env[t]=e[t]})),{parsed:e}}catch(e){return{error:e}}},e.exports.parse=u},21:(e,t,s)=>{"use strict";s.r(t),s.d(t,{NIL:()=>S,parse:()=>b,stringify:()=>c,v1:()=>m,v3:()=>v,v4:()=>w,v5:()=>C,validate:()=>l,version:()=>O});const r=require("crypto");var n=s.n(r);const o=new Uint8Array(256);let i=o.length;function a(){return i>o.length-16&&(n().randomFillSync(o),i=0),o.slice(i,i+=16)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=function(e){return"string"==typeof e&&d.test(e)},u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).substr(1));const c=function(e,t=0){const s=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!l(s))throw TypeError("Stringified UUID is invalid");return s};let f,p,g=0,h=0;const m=function(e,t,s){let r=t&&s||0;const n=t||new Array(16);let o=(e=e||{}).node||f,i=void 0!==e.clockseq?e.clockseq:p;if(null==o||null==i){const t=e.random||(e.rng||a)();null==o&&(o=f=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==i&&(i=p=16383&(t[6]<<8|t[7]))}let d=void 0!==e.msecs?e.msecs:Date.now(),l=void 0!==e.nsecs?e.nsecs:h+1;const u=d-g+(l-h)/1e4;if(u<0&&void 0===e.clockseq&&(i=i+1&16383),(u<0||d>g)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=d,h=l,p=i,d+=122192928e5;const m=(1e4*(268435455&d)+l)%4294967296;n[r++]=m>>>24&255,n[r++]=m>>>16&255,n[r++]=m>>>8&255,n[r++]=255&m;const b=d/4294967296*1e4&268435455;n[r++]=b>>>8&255,n[r++]=255&b,n[r++]=b>>>24&15|16,n[r++]=b>>>16&255,n[r++]=i>>>8|128,n[r++]=255&i;for(let e=0;e<6;++e)n[r+e]=o[e];return t||c(n)},b=function(e){if(!l(e))throw TypeError("Invalid UUID");let t;const s=new Uint8Array(16);return s[0]=(t=parseInt(e.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(e.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(e.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(e.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s};function y(e,t,s){function r(e,r,n,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let s=0;s<e.length;++s)t.push(e.charCodeAt(s));return t}(e)),"string"==typeof r&&(r=b(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let i=new Uint8Array(16+e.length);if(i.set(r),i.set(e,r.length),i=s(i),i[6]=15&i[6]|t,i[8]=63&i[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=i[e];return n}return c(i)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}const v=y("v3",48,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),n().createHash("md5").update(e).digest()})),w=function(e,t,s){const r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=r[e];return t}return c(r)},C=y("v5",80,(function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),n().createHash("sha1").update(e).digest()})),S="00000000-0000-0000-0000-000000000000",O=function(e){if(!l(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},53:e=>{e.exports={validatePerson:function(e){return e.name&&"string"==typeof e.name?e.age?e.hobbies||"array"==typeof e.hobbies?(e.hobbies.forEach((t=>{if("string"!=typeof t)return{isValid:!1,message:e.hobbies?"hobbies shoudbe should be array of string":"hobbies is required",statusCode:400}})),{isValid:!0}):{isValid:!1,message:e.hobbies?"hobbies shoudbe should be array of string":"hobbies is required",statusCode:400}:{isValid:!1,message:e.name?"age shoudbe number":"age is required",statusCode:400}:{isValid:!1,message:e.name?"name shoudbe string":"name is required",statusCode:400}}}},475:(e,t,s)=>{const{validate:r}=s(21);e.exports={validateUrl:function(e){let t=e.split("/");return"person"===t[1]&&t.length<=3?t[2]&&!r(t[2])?{isValid:!1,message:"id is not uuid",statusCode:404}:{isValid:!0,message:"url is valid"}:{isValid:!1,message:"url is incorrect",statusCode:404}}}},147:e=>{"use strict";e.exports=require("fs")},685:e=>{"use strict";e.exports=require("http")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},477:e=>{"use strict";e.exports=require("querystring")},310:e=>{"use strict";e.exports=require("url")}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{s(738).config();const e=s(685),t=s(147),r=s(310),{v4:n}=s(21),{parse:o}=s(477),{validateUrl:i}=s(475),{validatePerson:a}=s(53),d=process.env.PORT||3e3;e.createServer(((e,s)=>{let d="",l=t.createReadStream("./db.json");l.on("data",(e=>d+=e));let u=r.parse(e.url,!0);l.on("end",(()=>{let r=JSON.parse(d).persons,l=i(u.pathname);if(l.isValid){if("GET"==e.method){if(u.pathname.match(/^\/person$/))s.statusCode=200,s.setHeader("Content-Type","application/json"),s.end(d);else if(u.pathname.match(/^\/person\/\d|-|\w/g)){let e=u.pathname.split("/")[2],t=r.find((t=>t.id===e));t?(s.statusCode=200,s.setHeader("Content-Type","application/json"),t=JSON.stringify(t),s.end(t)):(s.statusCode=404,s.end(`user with id ${e} isn't finded`))}}else if("POST"==e.method){let i="";e.on("data",(e=>i+=e.toString())),e.on("end",(e=>{let d=o(i),l={id:n(),name:d.name?`${d.name}`:null,age:d.age?+d.age:null,hobbies:d.hobbies?d.hobbies.split(","):[]},u=a(l);u.isValid?(s.statusCode=201,s.setHeader("Content-Type","application/json"),r.push(l),r={persons:[...r]},r=JSON.stringify(r),t.createWriteStream("./db.json",{flags:"w"}).write(r),l=JSON.stringify(l),s.end(l)):(s.statusCode=u.statusCode,s.end(u.message))}))}else if("PUT"==e.method)if(u.pathname.match(/^\/person\/\d|-|\w/g)){let n=u.pathname.split("/")[2];if(r.find((e=>e.id===n))){let i="";e.on("data",(e=>i+=e.toString())),e.on("end",(e=>{let a=o(i);s.statusCode=200,s.setHeader("Content-Type","application/json");let d={id:n,name:a.name,age:a.age,hobbies:a.hobbies.split(",")};r.forEach(((e,t)=>{e.id===n&&(r[t]=d)})),r={persons:[...r]},r=JSON.stringify(r),t.createWriteStream("./db.json",{flags:"w"}).write(r),d=JSON.stringify(d),s.end(d)}))}else s.statusCode=404,s.end(`user with id ${n} isn't finded`)}else s.statusCode=400,s.end("user's id invalid");else if("DELETE"==e.method&&u.pathname.match(/^\/person\/\d|-|\w/g)){let e=u.pathname.split("/")[2];r.find((t=>t.id===e))?(r=r.filter((t=>t.id!==e)),r={persons:[...r]},r=JSON.stringify(r),t.createWriteStream("./db.json",{flags:"w"}).write(r),s.statusCode=204,s.setHeader("Content-Type","text/html"),s.end("<p>peerson was dremove</p>")):(s.statusCode=404,s.end(`user with id ${e} isn't finded`))}}else s.statusCode=l.statusCode,s.end(`${l.message}`)})),l.on("error",(e=>{s.statusCode=500,s.end("Error",e.message)}))})).listen(d,(()=>{console.log(`Server running at port ${d}`)}))})()})();